<!doctype html>
<html lang="cs">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>ZÃ¡pisnÃ­k (PWA)</title>

  <meta name="theme-color" content="#0f1729" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="ZÃ¡pisnÃ­k" />

  <!-- Manifest a ikony: absolutnÃ­ cesty pro GitHub Pages -->
  <link rel="manifest" href="/zapisnik/manifest.webmanifest" />
  <link rel="apple-touch-icon" href="/zapisnik/icons/icon-192.png" />

  <!-- Styl -->
  <link rel="stylesheet" href="/zapisnik/styles.css" />
</head>
<body>
  <header class="topbar">
    <div class="left">
      <button id="btn-install" title="Nainstalovat PWA" style="display:none">â• Nainstalovat</button>
      <select id="bg-select" title="PozadÃ­ strÃ¡nku">
        <option value="plain">BÃ­lÃ½ papÃ­r</option>
        <option value="ruled">LinkovanÃ½</option>
        <option value="grid">ÄŒtvereÄkovanÃ½</option>
      </select>
      <button id="btn-new-page" title="PÅ™idat strÃ¡nku">+ StrÃ¡nka</button>
      <span id="page-info"></span>
      <button id="btn-prev" title="PÅ™edchozÃ­ strÃ¡nka">â—€</button>
      <button id="btn-next" title="DalÅ¡Ã­ strÃ¡nka">â–¶</button>
    </div>
    <div class="right">
      <button id="btn-save" title="UloÅ¾it seÅ¡it do prohlÃ­Å¾eÄe">ğŸ’¾ UloÅ¾it</button>
      <button id="btn-load" title="NaÄÃ­st seÅ¡it z prohlÃ­Å¾eÄe">ğŸ“‚ NaÄÃ­st</button>
      <button id="btn-export" title="Export do PDF">ğŸ“„ Export PDF</button>
    </div>
  </header>

  <main class="workspace">
    <aside class="toolbar">
      <div class="tool-group">
        <div class="label">NÃ¡stroje</div>
        <button class="tool" data-tool="pen">âœ’ï¸ Pero</button>
        <button class="tool" data-tool="pencil">âœï¸ TuÅ¾ka</button>
        <button class="tool" data-tool="marker">ğŸ–ï¸ ZvÃ½razÅˆovaÄ</button>
        <button class="tool" data-tool="brush">ğŸ–Œï¸ Å tÄ›tec</button>
        <button class="tool" data-tool="eraser">ğŸ©¹ Guma</button>
        <button class="tool" data-tool="text">ğŸ”¤ Text</button>
        <button class="tool" data-tool="image">ğŸ–¼ï¸ ObrÃ¡zek</button>
        <button class="tool" data-tool="select">ğŸ”² VÃ½bÄ›r</button>
      </div>

      <div class="tool-group">
        <div class="label">Vlastnosti</div>
        <input type="color" id="color" value="#1f2937" title="Barva" />
        <label class="row">TlouÅ¡Å¥ka <input type="range" id="size" min="1" max="36" value="3" /></label>
        <label class="row">PrÅ¯hlednost <input type="range" id="alpha" min="0" max="1" step="0.05" value="1" /></label>
      </div>

      <div class="tool-group">
        <div class="label">Akce</div>
        <button id="btn-undo">â†¶ ZpÄ›t</button>
        <button id="btn-redo">â†· Znovu</button>
        <button id="btn-clear">ğŸ—‘ï¸ VyÄistit strÃ¡nku</button>
        <input type="file" id="image-input" accept="image/*" style="display:none" />
      </div>
    </aside>

    <section class="sheet-wrap">
      <canvas id="bg-canvas"></canvas>
      <canvas id="draw-canvas"></canvas>
      <textarea id="text-editor" placeholder="PiÅ¡â€¦"></textarea>
    </section>
  </main>

  <footer class="bottombar">
    <div>Tip: DlouhÃ½m stiskem v reÅ¾imu â€VÃ½bÄ›râ€œ uchopÃ­Å¡ text/obrÃ¡zek a pÅ™esuneÅ¡. DvÄ›ma prsty zoom/posun.</div>
  </footer>

  <!-- jsPDF pro export -->
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js" integrity="sha384-4UuW0b0Z3zQ6w0G1m8Q+3m8V5m3d2c4m5v3m2v1V" crossorigin="anonymous"></script>

  <!-- Aplikace -->
  <script type="module" src="/zapisnik/app.js"></script>

  <!-- Registrace SW s absolutnÃ­ cestou a deferred prompt pro instalaci -->
  <script>
    // Service Worker
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/zapisnik/sw.js');
      });
    }

    // PWA instalace (deferred prompt)
    let deferredPrompt;
    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      const btn = document.getElementById('btn-install');
      btn.style.display = 'inline-block';
      btn.onclick = async () => {
        if (deferredPrompt) {
          deferredPrompt.prompt();
          await deferredPrompt.userChoice;
          deferredPrompt = null;
          btn.style.display = 'none';
        }
      };
    });

    // iOS: zobrazit tlaÄÃ­tko, i kdyÅ¾ nepodporuje event (pouze nÃ¡vod k â€PÅ™idat na plochuâ€œ)
    if (/iphone|ipad|ipod/i.test(navigator.userAgent)) {
      const btn = document.getElementById('btn-install');
      btn.style.display = 'inline-block';
      btn.onclick = () => alert('Na iOS otevÅ™i sdÃ­lecÃ­ nabÃ­dku a zvol â€PÅ™idat na plochuâ€œ.');
    }
  </script>
</body>
</html>
